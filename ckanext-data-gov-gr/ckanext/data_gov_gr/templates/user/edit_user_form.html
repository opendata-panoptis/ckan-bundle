{% ckan_extends %}

{% set enable_ckan_login = h.enable_internal_login() %}

{% block core_fields %}
  <fieldset>
    <legend>{{ _('Change details') }}</legend>
    {% if g.userobj.sysadmin and enable_ckan_login %}
      {{ form.input('name', label=_('Username'), id='field-username', value=data.name, error=errors.name, classes=['control-medium'], is_required=true) }}
    {% else %}
      {{ form.input('name', label=_('Username'), id='field-username', value=data.name, error=errors.name, classes=['control-medium'], attrs={'readonly': '', 'class': 'form-control'}) }}
    {% endif %}

    {% if enable_ckan_login %}
      {{ form.input('fullname', label=_('Full name'), id='field-fullname', value=data.fullname, error=errors.fullname, placeholder=_('eg. Joe Bloggs'), classes=['control-medium']) }}
    {% else %}
      {{ form.input('fullname', label=_('Full name'), id='field-fullname', value=data.fullname, error=errors.fullname, placeholder=_('eg. Joe Bloggs'), attrs={'readonly': '', 'class': 'form-control'}) }}
    {% endif %}

    {% if enable_ckan_login %}
      {{ form.input('email', label=_('Email'), id='field-email', type='email', value=data.email, error=errors.email, placeholder=_('eg. joe@example.com'), classes=['control-medium'], is_required=true) }}
    {% else %}
      {{ form.input('email', label=_('Email'), id='field-email', type='email', value=data.email, error=errors.email, placeholder=_('eg. joe@example.com'), attrs={'readonly': '', 'class': 'form-control'}, is_required=true) }}
    {% endif %}

    {{ form.markdown('about', label=_('About'), id='field-about', value=data.about, error=errors.about, placeholder=_('A little information about yourself')) }}

    {% set is_upload = data.image_url and not data.image_url.startswith('http') %}
    {% set is_url = data.image_url and data.image_url.startswith('http') %}

    {{ form.image_upload(data, errors, is_upload_enabled=h.uploads_enabled(), is_url=is_url, is_upload=is_upload, upload_label=_('Profile picture'), url_label=_('Profile picture URL') ) }}
  </fieldset>
{% endblock %}

{% block sysadmin_password %}
{% if enable_ckan_login %}
  <fieldset>
  <legend>{{ _('Change ' + data.name|capitalize + "'s" + ' password') }}</legend>
  {{ form.input('password1', type='password', label=_('Password'), id='field-password', value=data.password1, error=errors.password1, classes=['control-medium'], attrs={'autocomplete': 'off', 'class': 'form-control'} ) }}
  {{ form.input('password2', type='password', label=_('Confirm Password'), id='field-password-confirm', value=data.password2, error=errors.password2, classes=['control-medium'], attrs={'autocomplete': 'off', 'class': 'form-control'}) }}
  </fieldset>
{% endif %}
{% endblock %}

{% block sysadmin_old_password %}
{% if enable_ckan_login %}
  <fieldset>
    <legend>{{ _('Sysadmin password') }}</legend>
    {{ form.input('old_password',
                  type='password',
                  label=_('Sysadmin Password'),
                  id='field-password-old',
                  value=data.oldpassword,
                  error=errors.oldpassword,
                  classes=['control-medium'],
                  attrs={'autocomplete': 'off', 'class': 'form-control'}
                  ) }}

  </fieldset>
{% endif %}
{% endblock %}

{% block change_password %}
  {% if enable_ckan_login %}
  <fieldset>
    <legend>{{ _('Change password') }}</legend>
    {{ form.input('old_password',
                  type='password',
                  label=_('Old Password'),
                  id='field-password-old',
                  value=data.oldpassword,
                  error=errors.oldpassword,
                  classes=['control-medium'],
                  attrs={'autocomplete': 'off', 'class': 'form-control'}
                  ) }}

    {{ form.input('password1', type='password', label=_('Password'), id='field-password', value=data.password1, error=errors.password1, classes=['control-medium'], attrs={'autocomplete': 'off', 'class': 'form-control'} ) }}

    {{ form.input('password2', type='password', label=_('Confirm Password'), id='field-password-confirm', value=data.password2, error=errors.password2, classes=['control-medium'], attrs={'autocomplete': 'off', 'class': 'form-control'}) }}
  </fieldset>
  {% endif %}
{% endblock %}