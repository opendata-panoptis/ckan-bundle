{% extends "dataviewer/base.html" %}

{% block page %}
    {% set lang = h.lang() %}
    <style>
        #sdgmap-container {
            width: 100%;
            height: 600px;
            border: 1px solid #ddd;
            border-radius: 4px;
            overflow: hidden;
        }
        #sdgmap-iframe {
            width: 100%;
            height: 100%;
            border: none;
        }
        .sdgmap-info {
            margin-bottom: 15px;
            padding: 10px;
            background-color: #f8f9fa;
            border-left: 4px solid #007bff;
            border-radius: 4px;
        }
        .loading-dialog {
            text-align: center;
            padding: 20px;
            color: #666;
        }
        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #3498db;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 10px;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>

    <div class="sdgmap-info">
        {% if lang == 'el' %}
            <h4>Î•Î½ÏƒÏ‰Î¼Î¬Ï„Ï‰ÏƒÎ· Î•Î½Î¹Î±Î¯Î¿Ï… Î¨Î·Ï†Î¹Î±ÎºÎ¿Ï Î§Î¬ÏÏ„Î·</h4>
            <p>Î‘Ï…Ï„Î® Î· Ï€ÏÎ¿Î²Î¿Î»Î® ÎµÎ½ÏƒÏ‰Î¼Î±Ï„ÏÎ½ÎµÎ¹ Ï„Î¿Î½ Î•Î½Î¹Î±Î¯Î¿ Î¨Î·Ï†Î¹Î±ÎºÏŒ Î§Î¬ÏÏ„Î· Ï„Î·Ï‚ Î•Î»Î»Î¬Î´Î±Ï‚ (https://sdigmap.tee.gov.gr) Î³Î¹Î± Î²ÎµÎ»Ï„Î¹Ï‰Î¼Î­Î½Î· Î³ÎµÏ‰Î³ÏÎ±Ï†Î¹ÎºÎ® Î¿Ï€Ï„Î¹ÎºÎ¿Ï€Î¿Î¯Î·ÏƒÎ·.</p>
        {% else %}
            <h4>Unified Digital Map Integration</h4>
            <p>This view integrates the Greek Unified Digital Map service for enhanced geographic visualization.</p>
        {% endif %}
        
        <div style="background-color: #fff3cd; border: 1px solid #ffeaa7; border-radius: 4px; padding: 10px; margin: 10px 0;">
            {% if lang == 'el' %}
                <h5 style="color: #856404; margin-top: 0;">ğŸ“‹ ÎŸÎ´Î·Î³Î¯ÎµÏ‚ Î§ÏÎ®ÏƒÎ·Ï‚:</h5>
                <ol style="margin: 5px 0; padding-left: 20px; color: #856404;">
                    <li><strong>ÎšÎ±Ï„ÎµÎ²Î¬ÏƒÏ„Îµ Ï„Î¿ Î±ÏÏ‡ÎµÎ¯Î¿:</strong> ÎšÎ¬Î½Ï„Îµ ÎºÎ»Î¹Îº ÏƒÏ„Î¿Î½ Ï€Î±ÏÎ±ÎºÎ¬Ï„Ï‰ ÏƒÏÎ½Î´ÎµÏƒÎ¼Î¿ Î³Î¹Î± Î½Î± ÎºÎ±Ï„ÎµÎ²Î¬ÏƒÎµÏ„Îµ Ï„Î¿ Î³ÎµÏ‰Î³ÏÎ±Ï†Î¹ÎºÏŒ Î±ÏÏ‡ÎµÎ¯Î¿</li>
                    <li><strong>Î‘Î½Î¿Î¯Î¾Ï„Îµ Ï„Î¿Î½ Î•Î½Î¹Î±Î¯Î¿ Î¨Î·Ï†Î¹Î±ÎºÏŒ Î§Î¬ÏÏ„Î·:</strong> ÎŸ Ï‡Î¬ÏÏ„Î·Ï‚ Î¸Î± Ï†Î¿ÏÏ„Ï‰Î¸ÎµÎ¯ Ï€Î±ÏÎ±ÎºÎ¬Ï„Ï‰</li>
                    <li><strong>Î ÏÎ¿ÏƒÎ¸Î­ÏƒÏ„Îµ Ï„Î¿ Î±ÏÏ‡ÎµÎ¯Î¿ ÏƒÏ„Î¿Î½ Ï‡Î¬ÏÏ„Î·:</strong> Î§ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î®ÏƒÏ„Îµ Ï„Î± ÎµÏÎ³Î±Î»ÎµÎ¯Î± Ï„Î¿Ï… Î•Î½Î¹Î±Î¯Î¿Ï… Î¨Î·Ï†Î¹Î±ÎºÎ¿Ï Î§Î¬ÏÏ„Î· Î³Î¹Î± Î½Î± ÎµÎ¹ÏƒÎ¬Î³ÎµÏ„Îµ Ï„Î¿ Î±ÏÏ‡ÎµÎ¯Î¿ Ï€Î¿Ï… ÎºÎ±Ï„ÎµÎ²Î¬ÏƒÎ±Ï„Îµ</li>
                    <li><strong>Î•Î¾ÎµÏÎµÏ…Î½Î®ÏƒÏ„Îµ Ï„Î± Î´ÎµÎ´Î¿Î¼Î­Î½Î±:</strong> Î§ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î®ÏƒÏ„Îµ Ï„Î¹Ï‚ Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î¯ÎµÏ‚ Ï„Î¿Ï… Ï‡Î¬ÏÏ„Î· Î³Î¹Î± Î±Î½Î¬Î»Ï…ÏƒÎ· ÎºÎ±Î¹ Î¿Ï€Ï„Î¹ÎºÎ¿Ï€Î¿Î¯Î·ÏƒÎ·</li>
                </ol>
            {% else %}
                <h5 style="color: #856404; margin-top: 0;">ğŸ“‹ Usage Instructions:</h5>
                <ol style="margin: 5px 0; padding-left: 20px; color: #856404;">
                    <li><strong>Download the file:</strong> Click the link below to download the geographic file</li>
                    <li><strong>Open the Unified Digital Map:</strong> The map will load below</li>
                    <li><strong>Add the file to the map:</strong> Use the Unified Digital Map's tools to import the file you downloaded</li>
                    <li><strong>Explore the data:</strong> Use the map's features for analysis and visualization</li>
                </ol>
            {% endif %}
        </div>

        {% if resource_url %}
            {% if lang == 'el' %}
                <p><strong>Î›Î®ÏˆÎ· Î‘ÏÏ‡ÎµÎ¯Î¿Ï…:</strong>
                    <a href="{{ resource_url }}" target="_blank" style="background-color: #28a745; color: white; padding: 5px 10px; text-decoration: none; border-radius: 3px;">
                        â¬‡ï¸ {{ resource.name or resource_url }}
                    </a>
                    {% if resource_format %}
                        <span style="background-color: #6c757d; color: white; padding: 2px 6px; border-radius: 3px; font-size: 0.8em; margin-left: 5px;">{{ resource_format.upper() }}</span>
                    {% endif %}
                </p>
            {% else %}
                <p><strong>Original Resource:</strong> 
                    <a href="{{ resource_url }}" target="_blank" style="background-color: #28a745; color: white; padding: 5px 10px; text-decoration: none; border-radius: 3px;">
                        ğŸ“¥ Download: {{ resource.name or resource_url }}
                    </a>
                    {% if resource_format %}
                        <span style="background-color: #6c757d; color: white; padding: 2px 6px; border-radius: 3px; font-size: 0.8em; margin-left: 5px;">{{ resource_format.upper() }}</span>
                    {% endif %}
                </p>
            {% endif %}
        {% endif %}
    </div>

    <div id="sdgmap-container">
        <div class="loading-dialog" id="loading-dialog">
            <div class="loading-spinner"></div>
            {% if lang == 'el' %}
                <span>Î¦ÏŒÏÏ„Ï‰ÏƒÎ· Î•Î½Î¹Î±Î¯Î¿Ï… Î¨Î·Ï†Î¹Î±ÎºÎ¿Ï Î§Î¬ÏÏ„Î·...</span>
            {% else %}
                <span>Loading Unified Digital Map...</span>
            {% endif %}
        </div>
        <iframe id="sdgmap-iframe" 
                src="{{ sdgmap_url }}" 
                title="{% if lang == 'el' %}Î•Î»Î»Î·Î½Î¹ÎºÏŒÏ‚ Î•Î½Î¹Î±Î¯Î¿Ï‚ Î¨Î·Ï†Î¹Î±ÎºÏŒÏ‚ Î§Î¬ÏÏ„Î·Ï‚{% else %}Greek Unified Digital Map{% endif %}"
                style="display: none;"
                onload="document.getElementById('loading-dialog').style.display='none'; this.style.display='block';">
        </iframe>
    </div>

    <div class="sdgmap-info" style="margin-top: 15px;">
        <small>
            {% if lang == 'el' %}
                Î¥Ï€Î¿ÏƒÏ„Î·ÏÎ¯Î¶ÎµÏ„Î±Î¹ Î±Ï€ÏŒ 
                <a href="https://sdigmap.tee.gov.gr" target="_blank">Î•Î½Î¹Î±Î¯Î¿Ï‚ Î¨Î·Ï†Î¹Î±ÎºÏŒÏ‚ Î§Î¬ÏÏ„Î·Ï‚</a> - 
                Î¤ÎµÏ‡Î½Î¹ÎºÏŒ Î•Ï€Î¹Î¼ÎµÎ»Î·Ï„Î®ÏÎ¹Î¿ Î•Î»Î»Î¬Î´Î±Ï‚ (Î¤Î•Î•)
            {% else %}
                Powered by 
                <a href="https://sdigmap.tee.gov.gr" target="_blank">Unified Digital Map</a> - 
                Technical Chamber of Greece (TEE)
            {% endif %}
        </small>
    </div>

    <script>
        // Handle iframe loading and error cases
        document.addEventListener('DOMContentLoaded', function() {
            var iframe = document.getElementById('sdgmap-iframe');
            var loadingDialog = document.getElementById('loading-dialog');
            
            // Set a timeout in case the iframe doesn't load
            setTimeout(function() {
                if (loadingDialog.style.display !== 'none') {
                    {% if lang == 'el' %}
                        loadingDialog.innerHTML = '<span style="color: #dc3545;">Î‘Î´ÏÎ½Î±Ï„Î· Î· Ï†ÏŒÏÏ„Ï‰ÏƒÎ· Ï„Î¿Ï… Î•Î½Î¹Î±Î¯Î¿Ï… Î¨Î·Ï†Î¹Î±ÎºÎ¿Ï Î§Î¬ÏÏ„Î·. Î•Î»Î­Î³Î¾Ï„Îµ Ï„Î· ÏƒÏÎ½Î´ÎµÏƒÎ® ÏƒÎ±Ï‚ ÏƒÏ„Î¿ Î´Î¹Î±Î´Î¯ÎºÏ„Ï…Î¿ Î® Î´Î¿ÎºÎ¹Î¼Î¬ÏƒÏ„Îµ Î¾Î±Î½Î¬ Î±ÏÎ³ÏŒÏ„ÎµÏÎ±.</span>';
                    {% else %}
                        loadingDialog.innerHTML = '<span style="color: #dc3545;">Unable to load Unified Digital Map. Please check your internet connection or try again later.</span>';
                    {% endif %}
                }
            }, 15000); // 15 second timeout
            
            // Handle iframe errors
            iframe.addEventListener('error', function() {
                {% if lang == 'el' %}
                    loadingDialog.innerHTML = '<span style="color: #dc3545;">Î£Ï†Î¬Î»Î¼Î± Ï†ÏŒÏÏ„Ï‰ÏƒÎ·Ï‚ Ï„Î¿Ï… Î•Î½Î¹Î±Î¯Î¿Ï… Î¨Î·Ï†Î¹Î±ÎºÎ¿Ï Î§Î¬ÏÏ„Î·.</span>';
                {% else %}
                    loadingDialog.innerHTML = '<span style="color: #dc3545;">Error loading Unified Digital Map service.</span>';
                {% endif %}
            });
        });
    </script>

{% endblock %}